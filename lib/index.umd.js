(function(C,w){typeof exports=="object"&&typeof module<"u"?w(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],w):(C=typeof globalThis<"u"?globalThis:C||self,w(C.ESDrager={},C.Vue))})(this,function(C,w){"use strict";const ie={tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},maxWidth:{type:Number,default:0},maxHeight:{type:Number,default:0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array},equalProportion:{type:Boolean},checkCollision:{type:Boolean}};function K(o,n){const e=t=>{n&&n(t),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",o),document.addEventListener("touchend",e)}function T(o){let n=0,e=0;if(re(o)){const t=o.targetTouches[0];n=t.pageX,e=t.pageY}else n=o.clientX,e=o.clientY;return{clientX:n,clientY:e}}function re(o){const n=Object.prototype.toString.call(o);return n.substring(8,n.length-1)==="TouchEvent"}const S=(o=0)=>parseInt(o+"")+"px",O={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},U=["n","ne","e","se","s","sw","w","nw"],ae={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},ce={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},le=(o,n)=>{const e=ce[Math.floor(o/30)],s=(ae[n]+e)%8;return U[s]},j=(o=0,n)=>{let e=[];for(let t=0;t<U.length;t++){const s=U[t],[d,c]=O[s].split("-"),f=le(o,s),i={[d]:"0%",cursor:f+"-resize",side:O[s]};if(c)i[c]="0%";else{const h=["top","bottom"].includes(d)?"left":"top";i[h]="50%"}n?n.includes(O[s])&&e.push(i):e.push(i)}return e},q=o=>o*Math.PI/180,ue=(o,n)=>Math.sqrt(o*o+n*n),m=o=>Math.cos(q(o)),y=o=>Math.sin(q(o)),de=(o,n,e,t,s,d,c)=>{let{width:f,height:i,centerX:h,centerY:p,rotateAngle:r}=n;const u=f<0?-1:1,g=i<0?-1:1;switch(f=Math.abs(f),i=Math.abs(i),o){case"right":{const a=x(f,e,d);f=a.width,e=a.deltaW,s?(t=e/s,i=f/s,h+=e/2*m(r)-t/2*y(r),p+=e/2*y(r)+t/2*m(r)):(h+=e/2*m(r),p+=e/2*y(r));break}case"top-right":{t=-t;const a=x(f,e,d);f=a.width,e=a.deltaW;const v=z(i,t,c);i=v.height,t=v.deltaH,s&&(e=t*s,f=i*s),h+=e/2*m(r)+t/2*y(r),p+=e/2*y(r)-t/2*m(r);break}case"bottom-right":{const a=x(f,e,d);f=a.width,e=a.deltaW;const v=z(i,t,c);i=v.height,t=v.deltaH,s&&(e=t*s,f=i*s),h+=e/2*m(r)-t/2*y(r),p+=e/2*y(r)+t/2*m(r);break}case"bottom":{const a=z(i,t,c);i=a.height,t=a.deltaH,s?(e=t*s,f=i*s,h+=e/2*m(r)-t/2*y(r),p+=e/2*y(r)+t/2*m(r)):(h-=t/2*y(r),p+=t/2*m(r));break}case"bottom-left":{e=-e;const a=x(f,e,d);f=a.width,e=a.deltaW;const v=z(i,t,c);i=v.height,t=v.deltaH,s&&(i=f/s,t=e/s),h-=e/2*m(r)+t/2*y(r),p-=e/2*y(r)-t/2*m(r);break}case"left":{e=-e;const a=x(f,e,d);f=a.width,e=a.deltaW,s?(i=f/s,t=e/s,h-=e/2*m(r)+t/2*y(r),p-=e/2*y(r)-t/2*m(r)):(h-=e/2*m(r),p-=e/2*y(r));break}case"top-left":{e=-e,t=-t;const a=x(f,e,d);f=a.width,e=a.deltaW;const v=z(i,t,c);i=v.height,t=v.deltaH,s&&(f=i*s,e=t*s),h-=e/2*m(r)-t/2*y(r),p-=e/2*y(r)+t/2*m(r);break}case"top":{t=-t;const a=z(i,t,c);i=a.height,t=a.deltaH,s?(f=i*s,e=t*s,h+=e/2*m(r)+t/2*y(r),p+=e/2*y(r)-t/2*m(r)):(h+=t/2*y(r),p-=t/2*m(r));break}}return{position:{centerX:h,centerY:p},size:{width:f*u,height:i*g}}},z=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{height:o,deltaH:n}},x=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{width:o,deltaW:n}},fe=({centerX:o,centerY:n,width:e,height:t,angle:s})=>({top:n-t/2,left:o-e/2,width:e,height:t,angle:s}),he=(o,n,e)=>{const{width:t,height:s}=o;return{width:Math.abs(t),height:Math.abs(s),left:n-Math.abs(t)/2,top:e-Math.abs(s)/2}};function $(o,n){const e=Math.abs(o)%n,t=o>0?n:-n;let s=0;return e>n/2?s=t*Math.ceil(Math.abs(o)/n):s=t*Math.floor(Math.abs(o)/n),s}function ge(o,n){if(!o||!n)return!1;const e=o.getBoundingClientRect(),t=n.getBoundingClientRect();return e.left<t.left+t.width&&e.left+e.width>t.left&&e.top<t.top+t.height&&e.top+e.height>t.top}function ve(o,n,e,{getBoundary:t,fixBoundary:s,checkDragerCollision:d,emit:c}){let f=0,i=0;const h=r=>{let{left:u,top:g}=n.value;if(f||(f=u),i||(i=g),["ArrowRight","ArrowLeft"].includes(r.key)){const a=r.key==="ArrowRight";let v=a?1:-1;o.snapToGrid&&(v=a?o.gridX:-o.gridX),u=u+v}else if(["ArrowUp","ArrowDown"].includes(r.key)){const a=r.key==="ArrowDown";let v=a?1:-1;o.snapToGrid&&(v=a?o.gridY:-o.gridY),g=g+v}if(o.boundary){const[a,v,M,R]=t();[u,g]=s(u,g,a,v,M,R)}n.value.left=u,n.value.top=g,c("change",{...n.value})},p=r=>{["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(r.key)&&o.checkCollision&&d()&&(n.value.left=f,n.value.top=i),f=0,i=0};w.watch(e,r=>{o.disabledKeyEvent||(r?(document.addEventListener("keydown",h),document.addEventListener("keyup",p)):(document.removeEventListener("keydown",h),document.removeEventListener("keyup",p)))}),w.onBeforeUnmount(()=>{document.removeEventListener("keydown",h),document.removeEventListener("keyup",p)})}function pe(o,n,e){const t=w.ref(!1),s=w.ref(!1),d=w.ref({width:n.width,height:n.height,left:n.left,top:n.top,angle:n.angle}),c=new Set;function f(u){if(c.add(u.button),n.disabled)return;t.value=!0,s.value=!0;let{clientX:g,clientY:a}=T(u);const{left:v,top:M}=d.value;let R=0,l=0,b=0,_=0;n.boundary&&([R,l,b,_]=i()),e&&e("drag-start",d.value),K(A=>{if(c.size>1)return;const{clientX:E,clientY:B}=T(A);let D=(E-g)/n.scaleRatio+v,L=(B-a)/n.scaleRatio+M;if(n.snapToGrid){let{left:N,top:I}=d.value;const V=D-N,X=L-I;D=N+$(V,n.gridX),L=I+$(X,n.gridY)}n.boundary&&([D,L]=h(D,L,R,l,b,_)),d.value.left=D,d.value.top=L,e&&e("drag",d.value)},A=>{n.checkCollision&&p()&&(d.value.top=M,d.value.left=v),c.clear(),t.value=!1,document.addEventListener("click",r,{once:!0}),e&&e("drag-end",d.value)})}const i=()=>{let u=0,g=0;const{left:a,top:v,height:M,width:R,angle:l}=d.value,_=(o.value.parentElement||document.body).getBoundingClientRect();if(l&&n.scaleRatio===1){const E=o.value.getBoundingClientRect();u=Math.abs(E.left-(a+_.left)),g=Math.abs(E.top-(v+_.top))}const k=_.width/n.scaleRatio-R,A=_.height/n.scaleRatio-M;return[u,k-u,g,A-g,_.width/n.scaleRatio,_.height/n.scaleRatio]},h=(u,g,a,v,M,R)=>(u=u<a?a:u,u=u>v?v:u,g=g<M?M:g,g=g>R?R:g,[u,g]),p=()=>{const u=o.value.parentElement||document.body,g=Array.from(u.children).filter(a=>a!==o.value&&a.classList.contains("es-drager"));for(let a=0;a<g.length;a++){const v=g[a];if(ge(o.value,v))return!0}},r=()=>{s.value=!1};return ve(n,d,s,{getBoundary:i,fixBoundary:h,checkDragerCollision:p,emit:e}),w.onMounted(()=>{if(o.value){if(!d.value.width&&!d.value.height){const{width:u,height:g}=o.value.getBoundingClientRect();d.value={...d.value,width:u||100,height:g||100},e("change",{...d.value})}o.value.addEventListener("mousedown",f),o.value.addEventListener("touchstart",f,{passive:!0})}}),{isMousedown:t,selected:s,dragData:d,getBoundary:i,checkDragerCollision:p}}const we=w.defineComponent({__name:"rotate",props:{value:{type:Number,default:0},element:{type:HTMLElement,default:null}},emits:["input","rotate","rotate-start","rotate-end"],setup(o,{emit:n}){const e=o,t=w.ref(null),s=w.computed({get:()=>e.value,set:c=>{n("input",c)}});function d(c){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");c.stopPropagation();const{width:f,height:i,left:h,top:p}=e.element.getBoundingClientRect(),r=h+f/2,u=p+i/2;n("rotate-start",s.value),K(g=>{const{clientX:a,clientY:v}=T(g),M=r-a,R=u-v,b=Math.atan2(R,M)*180/Math.PI-90;s.value=(b+360)%360,n("rotate",s.value)},()=>{n("rotate-end",s.value)})}return{__sfc:!0,props:e,emit:n,rotateRef:t,angle:s,onRotateMousedown:d}}}),Pe="";function J(o,n,e,t,s,d,c,f){var i=typeof o=="function"?o.options:o;n&&(i.render=n,i.staticRenderFns=e,i._compiled=!0),t&&(i.functional=!0),d&&(i._scopeId="data-v-"+d);var h;if(c?(h=function(u){u=u||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!u&&typeof __VUE_SSR_CONTEXT__<"u"&&(u=__VUE_SSR_CONTEXT__),s&&s.call(this,u),u&&u._registeredComponents&&u._registeredComponents.add(c)},i._ssrRegister=h):s&&(h=f?function(){s.call(this,(i.functional?this.parent:this).$root.$options.shadowRoot)}:s),h)if(i.functional){i._injectStyles=h;var p=i.render;i.render=function(g,a){return h.call(a),p(g,a)}}else{var r=i.beforeCreate;i.beforeCreate=r?[].concat(r,h):[h]}return{exports:o,options:i}}var me=function(){var n=this,e=n._self._c,t=n._self._setupProxy;return e("div",{ref:"rotateRef",staticClass:"es-drager-rotate",on:{mousedown:t.onRotateMousedown,"&touchstart":function(s){return t.onRotateMousedown.apply(null,arguments)}}},[n._t("default",function(){return[e("div",{staticClass:"es-drager-rotate-handle"},[e("svg",{attrs:{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"}})])])]})],2)},ye=[],_e=J(we,me,ye,!1,null,null,null,null);const be=_e.exports,Me=w.defineComponent({__name:"drager",props:ie,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(o,{emit:n}){const e=o,t=(l,...b)=>{n(l,...b),n("change",...b)},s=w.ref(null),{selected:d,dragData:c,isMousedown:f,getBoundary:i,checkDragerCollision:h}=pe(s,e,t),p=w.ref(j(0,e.resizeList)),r=w.computed(()=>e.resizable&&!e.disabled),u=w.computed(()=>e.rotatable&&!e.disabled&&d.value),g=w.computed(()=>{const{width:l,height:b,left:_,top:k,angle:A}=c.value,E={};return l&&(E.width=S(l)),b&&(E.height=S(b)),{...E,left:S(_),top:S(k),zIndex:e.zIndex,transform:`rotate(${A}deg)`,"--es-drager-color":e.color}});function a(l){s.value||(s.value=l.$el||l)}function v(l){p.value=j(l,e.resizeList),t("rotate-end",c.value)}function M(l,b){if(e.disabled)return;b.stopPropagation();const{clientX:_,clientY:k}=T(b),A=_,E=k,{width:B,height:D,left:L,top:N}=c.value,I=L+B/2,V=N+D/2,X={width:B,height:D,centerX:I,centerY:V,rotateAngle:c.value.angle},ke=l.side,{minWidth:Ae,minHeight:Le,aspectRatio:Z,equalProportion:Ce}=e;t("resize-start",c.value);let H=[];e.boundary&&(H=i()),K(W=>{const{clientX:Xe,clientY:Ye}=T(W);let F=(Xe-A)/e.scaleRatio,G=(Ye-E)/e.scaleRatio;e.snapToGrid&&(F=$(F,e.gridX),G=$(G,e.gridY));const ze=Math.atan2(G,F),ee=ue(F,G),xe=W.shiftKey,te=ze-q(X.rotateAngle),Be=ee*Math.cos(te),Te=ee*Math.sin(te),ne=(Ce||xe)&&!Z?X.width/X.height:Z,{position:{centerX:oe,centerY:se},size:{width:Ne,height:Se}}=de(ke,{...X,rotateAngle:X.rotateAngle},Be,Te,ne,Ae,Le),$e=fe({centerX:oe,centerY:se,width:Ne,height:Se,angle:c.value.angle});let Y={...c.value,...he($e,oe,se)};e.maxWidth>0&&(Y.width=Math.min(Y.width,e.maxWidth)),e.maxHeight>0&&(Y.height=Math.min(Y.height,e.maxHeight)),e.boundary&&(Y=R(Y,H,ne)),c.value=Y,t("resize",c.value)},()=>{e.checkCollision&&h()&&(c.value={...c.value,width:B,height:D,left:L,top:N}),t("resize-end",c.value)})}function R(l,b,_){const[k,A,E,B,D,L]=b;return l.left<k&&(l.left=k,l.width=c.value.width,_&&(l.height=c.value.height)),l.left+l.width>D&&(l.left=c.value.left,l.width=D-l.left,_&&(l.height=c.value.height)),l.top<E&&(l.top=E,l.height=c.value.height,_&&(l.width=c.value.width)),l.top+l.height>L&&(l.top=c.value.top,l.height=L-l.top,_&&(l.width=c.value.width)),l}return w.watch(()=>[e.width,e.height,e.left,e.top,e.angle],([l,b,_,k,A])=>{c.value={...c.value,width:l,height:b,left:_,top:k,angle:A}}),w.watch(()=>e.selected,l=>{d.value=l},{immediate:!0}),{__sfc:!0,props:e,emit:n,emitFn:t,dragRef:s,selected:d,dragData:c,isMousedown:f,getBoundary:i,checkDragerCollision:h,dotList:p,showResize:r,showRotate:u,dragStyle:g,setRef:a,handleRotateEnd:v,onDotMousedown:M,fixResizeBoundary:R,Rotate:be}}}),Ie="";var Re=function(){var n=this,e=n._self._c,t=n._self._setupProxy;return e(n.tag,{ref:t.setRef,tag:"component",class:["es-drager",{disabled:n.disabled,dragging:t.isMousedown,selected:t.selected,border:n.border}],style:t.dragStyle,on:{click:function(s){s.stopPropagation()}}},[n._t("default"),t.showResize?n._l(t.dotList,function(s,d){return e("div",{key:d,staticClass:"es-drager-dot",style:{...s},attrs:{"data-side":s.side},on:{mousedown:function(c){return t.onDotMousedown(s,c)},"&touchstart":function(c){return t.onDotMousedown(s,c)}}},[n._t("resize",function(){return[e("div",{staticClass:"es-drager-dot-handle"})]},null,{side:s.side})],2)}):n._e(),t.showRotate?e(t.Rotate,{attrs:{element:t.dragRef},on:{rotate:function(s){return t.emitFn("rotate",t.dragData)},"rotate-start":function(s){return t.emitFn("rotate-start",t.dragData)},"rotate-end":t.handleRotateEnd},model:{value:t.dragData.angle,callback:function(s){n.$set(t.dragData,"angle",s)},expression:"dragData.angle"}},[n._t("rotate")],2):n._e()],2)},Ee=[],De=J(Me,Re,Ee,!1,null,null,null,null);const P=De.exports,Q=o=>{o.component("es-drager",P)};P.install=Q,C.ESDrager=P,C.default=P,C.install=Q,Object.defineProperties(C,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
